<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate expanded composition data for lengths and marginal ages — get_expanded_comps • nwfscSurvey</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate expanded composition data for lengths and marginal ages — get_expanded_comps"><meta name="description" content="Conduct a two-stage expansion of length and age composition data. The first
stage expands data up to the tow level and the second stage expands the data
up the user-defined strata areas. This function is designed to be used with
catch pulled using pull_catch() and biological data pulled using pull_bio()."><meta property="og:description" content="Conduct a two-stage expansion of length and age composition data. The first
stage expands data up to the tow level and the second stage expands the data
up the user-defined strata areas. This function is designed to be used with
catch pulled using pull_catch() and biological data pulled using pull_bio()."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nwfscSurvey</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/nwfscSurvey.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Calculate expanded composition data for lengths and marginal ages</h1>

      <div class="d-none name"><code>get_expanded_comps.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Conduct a two-stage expansion of length and age composition data. The first
stage expands data up to the tow level and the second stage expands the data
up the user-defined strata areas. This function is designed to be used with
catch pulled using <code><a href="pull_catch.html">pull_catch()</a></code> and biological data pulled using <code><a href="pull_bio.html">pull_bio()</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">get_expanded_comps</span><span class="op">(</span></span>
<span>  <span class="va">bio_data</span>,</span>
<span>  <span class="va">catch_data</span>,</span>
<span>  <span class="va">comp_bins</span>,</span>
<span>  <span class="va">strata</span>,</span>
<span>  dir <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  comp_column_name <span class="op">=</span> <span class="st">"length_cm"</span>,</span>
<span>  output <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"full_expansion_ss3_format"</span>, <span class="st">"tow_expansion_only"</span>,</span>
<span>    <span class="st">"full_expansion_unformatted"</span><span class="op">)</span>,</span>
<span>  two_sex_comps <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  input_n_method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"stewart_hamel"</span>, <span class="st">"tows"</span>, <span class="st">"total_samples"</span><span class="op">)</span>,</span>
<span>  month <span class="op">=</span> <span class="st">"Enter Month"</span>,</span>
<span>  fleet <span class="op">=</span> <span class="st">"Enter Fleet"</span>,</span>
<span>  partition <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  ageerr <span class="op">=</span> <span class="st">"Enter Numeric"</span>,</span>
<span>  Lbin_lo <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>  Lbin_hi <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>  age_low <span class="op">=</span> <span class="fu">lifecycle</span><span class="fu">::</span><span class="fu"><a href="https://lifecycle.r-lib.org/reference/deprecated.html" class="external-link">deprecated</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  age_high <span class="op">=</span> <span class="fu">lifecycle</span><span class="fu">::</span><span class="fu"><a href="https://lifecycle.r-lib.org/reference/deprecated.html" class="external-link">deprecated</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  age_error <span class="op">=</span> <span class="fu">lifecycle</span><span class="fu">::</span><span class="fu"><a href="https://lifecycle.r-lib.org/reference/deprecated.html" class="external-link">deprecated</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  printfolder <span class="op">=</span> <span class="st">"forSS3"</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-bio-data">bio_data<a class="anchor" aria-label="anchor" href="#arg-bio-data"></a></dt>
<dd><p>A data frame of length-composition data returned from
<code><a href="pull_bio.html">pull_bio()</a></code>.</p></dd>


<dt id="arg-catch-data">catch_data<a class="anchor" aria-label="anchor" href="#arg-catch-data"></a></dt>
<dd><p>A data frame of catch data returned from <code><a href="pull_catch.html">pull_catch()</a></code>.</p></dd>


<dt id="arg-comp-bins">comp_bins<a class="anchor" aria-label="anchor" href="#arg-comp-bins"></a></dt>
<dd><p>Vector of intergers to bin length or age data by
create expanded composition data.Values above or below the minimum or maximum
values in the vector are grouped into the first size or plus group size, respectively.
For example, creating length compositions that uses a vector bin of seq(10, 50, 2)
would create 2 cm bins where fish length between [0, 11.99) would be included in the
10 cm bin, fish of length [12, 13.99) would be included in the 12 cm bin, and
all fish [50- Inf) would be included in the 50 cm plus bin.</p></dd>


<dt id="arg-strata">strata<a class="anchor" aria-label="anchor" href="#arg-strata"></a></dt>
<dd><p>A data frame that defines the strata and provides the
calculated areas for each strata returned from <code>createStrataDF.fn()</code>.</p></dd>


<dt id="arg-dir">dir<a class="anchor" aria-label="anchor" href="#arg-dir"></a></dt>
<dd><p>Directory where output will be saved. The directory where the file should be saved.
If dir = NULL no output will be saved.</p></dd>


<dt id="arg-comp-column-name">comp_column_name<a class="anchor" aria-label="anchor" href="#arg-comp-column-name"></a></dt>
<dd><p>The name of the column to create composition data for that
must be a string. This column can be is used to determine whether to format the
composition data for length or age compositions by looking for either age
(e.g., <code>age_years</code>, <code>Age</code>, <code>age</code>, <code>best_age</code>) or length (e.g., <code>length</code>,
<code>length_cm</code>, <code>Length</code>, <code>Length_cm</code>) in the comp_column_name. The comp_column_name
is not case sensitive.The default is <code>length_cm</code>.</p></dd>


<dt id="arg-output">output<a class="anchor" aria-label="anchor" href="#arg-output"></a></dt>
<dd><p>Switch to specify how to return the composition data where the options
are c("full_expansion_ss3_format", "tow_expansion_only", "full_expansion_unformatted").
The default is <code>output = "full_expansion_ss3_format"</code> where a list is returned with
formatted composition data for SS3. The <code>tow_expansion_only</code> retuns a dataframe of
composition data only expanded up to the tow level (first-stage) and
<code>full_expansion_unformatted</code> returns a dataframe with compositon data expanded up to
the tow and strata level but not formatted for SS3.</p></dd>


<dt id="arg-two-sex-comps">two_sex_comps<a class="anchor" aria-label="anchor" href="#arg-two-sex-comps"></a></dt>
<dd><p>Default TRUE. If TRUE composition data will be formatted for a
Stock Synthesis two-sex model and if FALSE composition data will be formatted for a
single-sex model.</p></dd>


<dt id="arg-input-n-method">input_n_method<a class="anchor" aria-label="anchor" href="#arg-input-n-method"></a></dt>
<dd><p>Determines the default input sample size to add to
the composition data for SS3. There are three options: c("stewart_hamel", "tows",
"total_samples") where the default is "stewart_hamel".</p></dd>


<dt id="arg-month">month<a class="anchor" aria-label="anchor" href="#arg-month"></a></dt>
<dd><p>Month the samples were collected based on the expected format for
Stock Synthesis to determine the length/age estimate to compare to. Default
"Enter Month".</p></dd>


<dt id="arg-fleet">fleet<a class="anchor" aria-label="anchor" href="#arg-fleet"></a></dt>
<dd><p>A fleet number to assign the composition data to based on the expected
format for Stock Synthesis. Default "Enter Fleet".</p></dd>


<dt id="arg-partition">partition<a class="anchor" aria-label="anchor" href="#arg-partition"></a></dt>
<dd><p>Partition to assign the composition data based on the expected
format for Stock Synthesis. Partition of 0 indicates that the composition data
include all composition data, 1 for discarded composition data, and 2 for retained
fish only. Default of 0.</p></dd>


<dt id="arg-ageerr">ageerr<a class="anchor" aria-label="anchor" href="#arg-ageerr"></a></dt>
<dd><p>Number of ageing error vector to apply to the age data based on
Stock Synthesis. Default "Enter Numeric".</p></dd>


<dt id="arg-lbin-lo">Lbin_lo<a class="anchor" aria-label="anchor" href="#arg-lbin-lo"></a></dt>
<dd><p>Lower age bin for all age composition data based on the expected
format for Stock Synthesis. Default value of -1 which translates to the lowest age
bin.</p></dd>


<dt id="arg-lbin-hi">Lbin_hi<a class="anchor" aria-label="anchor" href="#arg-lbin-hi"></a></dt>
<dd><p>Upper age bin for all age composition data based on the expected
format for Stock Synthesis. Default value of -1 which translates to the highest</p></dd>


<dt id="arg-age-low">age_low<a class="anchor" aria-label="anchor" href="#arg-age-low"></a></dt>
<dd><p>Deprecated with nwfscSurvey 2.2. Use Lbin_lo instead.</p></dd>


<dt id="arg-age-high">age_high<a class="anchor" aria-label="anchor" href="#arg-age-high"></a></dt>
<dd><p>Deprecated with nwfscSurvey 2.2. Use Lbin_hi instead.</p></dd>


<dt id="arg-age-error">age_error<a class="anchor" aria-label="anchor" href="#arg-age-error"></a></dt>
<dd><p>Deprecated with nwfscSurvey 2.2. Use Lbin_hi instead.</p></dd>


<dt id="arg-printfolder">printfolder<a class="anchor" aria-label="anchor" href="#arg-printfolder"></a></dt>
<dd><p>A string that will be appended to <code>dir</code>, creating a folder
where the output will be saved. If specified as <code>""</code>,
the output will just be saved directly in <code>dir</code>. The default is <code>"forSS3"</code>.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>A logical that specifies if you want to print messages and
warnings to the console. The default is <code>TRUE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list or dataframe is returned depending upon <code>output</code>.
The default <code>output = "full_expansion_ss3_format"</code> returns a list of
expanded composition data by sex grouping (e.g., sexed and unsexed fish)
formatted for Stock Synthesis v.3.30+. If <code>output = "full_expansion_unformatted"</code>
a dataframe is returned of unformatted expanded composition data and if
<code>output = "tow_expansion_only"</code> a dataframe is returned with the composition
data only expanded to the tow level (first stage expansion only).</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>See
<code><a href="get_input_n.html">get_input_n</a></code> for information on input sample size calculations.</p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Chantel Wetzel and Allan Hicks</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">bio</span> <span class="op">&lt;-</span> <span class="fu"><a href="pull_bio.html">pull_bio</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  common_name <span class="op">=</span> <span class="st">"lingcod"</span>,</span></span>
<span class="r-in"><span>  survey <span class="op">=</span> <span class="st">"NWFSC.Combo"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">catch</span> <span class="op">&lt;-</span> <span class="fu"><a href="pull_catch.html">pull_catch</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  common_name <span class="op">=</span> <span class="st">"lingcod"</span>,</span></span>
<span class="r-in"><span>  survey <span class="op">=</span> <span class="st">"NWFSC.Combo"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">strata</span> <span class="op">&lt;-</span> <span class="fu"><a href="CreateStrataDF.fn.html">CreateStrataDF.fn</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"shallow_wa"</span>, <span class="st">"shallow_or"</span>, <span class="st">"shallow_nca"</span>, <span class="st">"shelf_wa"</span>, <span class="st">"shelf_or"</span>, <span class="st">"shelf_nca"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  depths.shallow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">55</span>, <span class="fl">55</span>, <span class="fl">55</span>, <span class="fl">183</span>, <span class="fl">183</span>, <span class="fl">183</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  depths.deep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">183</span>, <span class="fl">183</span>, <span class="fl">183</span>, <span class="fl">350</span>, <span class="fl">350</span>, <span class="fl">350</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  lats.south <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">46.0</span>, <span class="fl">42.0</span>, <span class="fl">40.10</span>, <span class="fl">46.0</span>, <span class="fl">42.0</span>, <span class="fl">40.10</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  lats.north <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">49.0</span>, <span class="fl">46.0</span>, <span class="fl">42.0</span>, <span class="fl">49.0</span>, <span class="fl">46.0</span>, <span class="fl">42.0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">length_comps</span> <span class="op">&lt;-</span> <span class="fu">get_expanded_comps</span><span class="op">(</span></span></span>
<span class="r-in"><span>  bio_data <span class="op">=</span> <span class="va">bio</span>,</span></span>
<span class="r-in"><span>  catch_data <span class="op">=</span> <span class="va">catch</span>,</span></span>
<span class="r-in"><span>  strata <span class="op">=</span> <span class="va">strata</span>,</span></span>
<span class="r-in"><span>  comp_bins <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">70</span>, <span class="fl">4</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  comp_column_name <span class="op">=</span> <span class="st">"length_cm"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Chantel R. Wetzel, Kelli F. Johnson, Allan C. Hicks.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

