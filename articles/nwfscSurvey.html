<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>nwfscSurvey • nwfscSurvey</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="nwfscSurvey">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nwfscSurvey</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/nwfscSurvey.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>nwfscSurvey</h1>
                        <h4 data-toc-skip class="author">Chantel
Wetzel</h4>
            
            <h4 data-toc-skip class="date">2025-09-12</h4>
      

      <div class="d-none name"><code>nwfscSurvey.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <strong>nwfscSurvey</strong> package was written by scientists at
the Northwest Fisheries Science Center (NWFSC) to explore and process
survey composition data for use in groundfish stockassessments. The
package can be used for the NWFSC West Coast Groundfish Bottom Trawl
(WCGBT) survey, the NWFSC slope survey, the Alaska Fisheries Science
Center (AFSC) slope survey, and the AFSC Triennial survey. The package
includes functions that query the <a href="https://www.nwfsc.noaa.gov/data" class="external-link">NWFSC data warehouse</a>,
visualize, and process the data for use in groundfish assessments.</p>
</div>
<div class="section level2">
<h2 id="use">Use<a class="anchor" aria-label="anchor" href="#use"></a>
</h2>
<p><strong>nwfscSurvey</strong> can be used to:</p>
<ul>
<li><p>Pull survey catch, haul, and biological data from the NWFSC data
warehouse.</p></li>
<li><p>Calculate the design based indices based upon pre-specified
stratification.</p></li>
<li><p>Create length- and age-composition data expanded by the
design-based indices formated for use in Stock Synthesis.</p></li>
<li><p>Create unexpanded conditional age-at-length composition data for
use in Stock Synthesis.</p></li>
<li><p>Create plots to visualize the data: design-based index plots,
bubble plots of length and age data, observeed sex ratio, and
distributions across depth and latitude.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="functions">Functions<a class="anchor" aria-label="anchor" href="#functions"></a>
</h2>
<p>A list of all functions in the packages can be viewed by:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="st">"package:nwfscSurvey"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<div class="section level3">
<h3 id="nwfsc-wcgbt-survey">NWFSC WCGBT Survey<a class="anchor" aria-label="anchor" href="#nwfsc-wcgbt-survey"></a>
</h3>
<div class="section level4">
<h4 id="pull-data">Pull data<a class="anchor" aria-label="anchor" href="#pull-data"></a>
</h4>
<p>Pull both the catch and biological data:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">catch</span> <span class="op">=</span> <span class="fu"><a href="../reference/pull_catch.html">pull_catch</a></span><span class="op">(</span></span>
<span>  common_name <span class="op">=</span> <span class="st">"Pacific ocean perch"</span>, </span>
<span>  survey <span class="op">=</span> <span class="st">"NWFSC.Combo"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bio</span> <span class="op">=</span> <span class="fu"><a href="../reference/pull_bio.html">pull_bio</a></span><span class="op">(</span></span>
<span>  common_name <span class="op">=</span> <span class="st">"Pacific ocean perch"</span>, </span>
<span>  survey <span class="op">=</span> <span class="st">"NWFSC.Combo"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="initial-data-visualization">Initial data visualization<a class="anchor" aria-label="anchor" href="#initial-data-visualization"></a>
</h4>
<p>There are a range of functions to create visualizations of the data
by examining catch rates by latitude or depth, lengths or ages by
latitude and depth, presence/absence in tows, and observed sex
ratios.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_cpue.html">plot_cpue</a></span><span class="op">(</span></span>
<span>  catch <span class="op">=</span> <span class="va">catch</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_bio_patterns.html">plot_bio_patterns</a></span><span class="op">(</span></span>
<span>  bio <span class="op">=</span> <span class="va">bio</span>, </span>
<span>  col_name <span class="op">=</span> <span class="st">"Length_cm"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/wh_plot_proportion.html">wh_plot_proportion</a></span><span class="op">(</span></span>
<span>  data_catch <span class="op">=</span> <span class="va">catch</span>,</span>
<span>  data_bio <span class="op">=</span> <span class="va">bio</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="define-strata">Define strata<a class="anchor" aria-label="anchor" href="#define-strata"></a>
</h4>
<p>Depth and latitude strata are required to calculate a design-based
index of abundance as well as length and age compositions. The strata
should be specific to the range where the species in question has been
observed. Note that the WCGBT Survey sampling design has changes in
sampling intensity at 183 and 549 meters and north and south of 34.5
degrees latitude, so these should generally be included as strata breaks
if the range spans these values. Pacific ocean perch are rarely observed
south of 34.5 degrees or deeper than 540 m, so there’s no need to
include strata that have very few observations (the survey extends
southward to about 32 degrees and as deep as 1280 m):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">strata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CreateStrataDF.fn.html">CreateStrataDF.fn</a></span><span class="op">(</span></span>
<span>  names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"shallow_s"</span>, <span class="st">"deep_s"</span>, <span class="st">"shallow_n"</span>, <span class="st">"deep_n"</span><span class="op">)</span>, </span>
<span>  depths.shallow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>  <span class="fl">55</span>,  <span class="fl">183</span>,  <span class="fl">55</span>, <span class="fl">183</span><span class="op">)</span>,</span>
<span>  depths.deep    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fl">183</span>,  <span class="fl">400</span>, <span class="fl">183</span>, <span class="fl">400</span><span class="op">)</span>,</span>
<span>  lats.south     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">34.5</span>, <span class="fl">34.5</span>,  <span class="fl">42</span>,  <span class="fl">42</span><span class="op">)</span>,</span>
<span>  lats.north     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>  <span class="fl">42</span>,   <span class="fl">42</span>,  <span class="fl">49</span>,  <span class="fl">49</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="index-of-abundance">Index of abundance<a class="anchor" aria-label="anchor" href="#index-of-abundance"></a>
</h4>
<p>Calculate the design based index of abundance:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">biomass</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_design_based.html">get_design_based</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">catch</span>,  </span>
<span>  strata <span class="op">=</span> <span class="va">strata</span><span class="op">)</span></span></code></pre></div>
<p><code><a href="../reference/get_design_based.html">get_design_based()</a></code> returns a list with elements
<code>$biomass_by_strata</code> and <code>$biomass</code>, where the
second element is the design based index of abundance aggregated across
strata. If the <code>dir</code> function input is specified, the
function writes a csv file inside the dir input location to a “forSS3”
folder.</p>
<p>Plot the coastwide design based index of abundance with uncertainty
intervals:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_index.html">plot_index</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">biomass</span>,</span>
<span>  plot <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>Plot the design based index of abundance for each strata without
uncertainty intervals:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_index.html">plot_index</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">biomass</span>,</span>
<span>  plot <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="length-composition-data">Length composition data<a class="anchor" aria-label="anchor" href="#length-composition-data"></a>
</h4>
<p><code><a href="../reference/get_expanded_comps.html">get_expanded_comps()</a></code> calculates and formats the
length-composition data for Stock Synthesis:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">length_comps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_expanded_comps.html">get_expanded_comps</a></span><span class="op">(</span></span>
<span>    bio_data <span class="op">=</span> <span class="va">bio</span>,</span>
<span>    catch_data <span class="op">=</span> <span class="va">catch</span>,</span>
<span>    comp_bins <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">40</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>    strata <span class="op">=</span> <span class="va">strata</span>,</span>
<span>    comp_column_name <span class="op">=</span> <span class="st">"length_cm"</span>,</span>
<span>    output <span class="op">=</span> <span class="st">"full_expansion_ss3_format"</span>,</span>
<span>    two_sex_comps <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    input_n_method <span class="op">=</span> <span class="st">"stewart_hamel"</span><span class="op">)</span></span></code></pre></div>
<p>The above call will calculate the length frequencies for use in Stock
Synthesis. This function returns a list of sexed and unsexed length
composition data formatted for Stock Synthesis. If the <code>dir</code>
function input is specified, it will write these dataframes to separate
csv files inside the dir input location to a “forSS3” folder. In the
above example the input sample size is calculated based on the Stewart
and Hamel approach (e.g., unique samples calculated as a function of
species type and tows).</p>
<p>To plot the length frequency data:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_comps.html">plot_comps</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">length_comps</span><span class="op">)</span></span></code></pre></div>
<p>If the <code>dir</code> function input is specified, then a “plot”
folder will be created in the directory location and a png of the plot
will be saved.</p>
<p>There is also a function to create raw or unexpanded composition data
that works for either length or age data.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">raw_length_comps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_raw_comps.html">get_raw_comps</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">bio</span>,</span>
<span>    comp_bins <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">40</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>    comp_column_name <span class="op">=</span> <span class="st">"length_cm"</span>,</span>
<span>    two_sex_comps <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>This function returns a list of sexed and unsexed length composition
data formatted for Stock Synthesis. The input sample size is set equal
to the number of samples in the data frame.</p>
</div>
<div class="section level4">
<h4 id="marginal-age-composition-data">Marginal age composition data<a class="anchor" aria-label="anchor" href="#marginal-age-composition-data"></a>
</h4>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age_comps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_expanded_comps.html">get_expanded_comps</a></span><span class="op">(</span></span>
<span>    bio_data <span class="op">=</span> <span class="va">bio</span>,</span>
<span>    catch_data <span class="op">=</span> <span class="va">catch</span>,</span>
<span>    comp_bins <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">40</span>,</span>
<span>    strata <span class="op">=</span> <span class="va">strata</span>,</span>
<span>    comp_column_name <span class="op">=</span> <span class="st">"age"</span>,</span>
<span>    output <span class="op">=</span> <span class="st">"full_expansion_ss3_format"</span>,</span>
<span>    two_sex_comps <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    input_n_method <span class="op">=</span> <span class="st">"stewart_hamel"</span><span class="op">)</span></span></code></pre></div>
<p>The above call will calculate the marginal age-composition data for
the age data in a format for Stock Synthesis. This function returns a
list of sexed and unsexed age composition data formatted for Stock
Synthesis. If the <code>dir</code> function input is specified, it will
write these dataframes to separate csv files as well. In the above
example the input sample size is calculated based on the Stewart and
Hamel approach (e.g., unique samples calculated as a function of species
type and tows).</p>
<p>To plot the age frequency data:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_comps.html">plot_comps</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">age_comps</span><span class="op">)</span></span></code></pre></div>
<p>If the <code>dir</code> function input is specified, then a “plot”
folder will be created in the directory location and a png of the plot
will be saved.</p>
<p>There is also a function to create raw or unexpanded composition data
that works for either length or age data.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">raw_age_comps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_raw_comps.html">get_raw_comps</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">bio</span>,</span>
<span>    comp_bins <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">40</span>,</span>
<span>    comp_column_name <span class="op">=</span> <span class="st">"age"</span>,</span>
<span>    two_sex_comps <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>This function returns a list of sexed and unsexed marginal age
composition data formatted for Stock Synthesis. The input sample size is
set equal to the number of samples in the data frame.</p>
</div>
<div class="section level4">
<h4 id="conditional-age-at-length-data">Conditional-age-at-length data<a class="anchor" aria-label="anchor" href="#conditional-age-at-length-data"></a>
</h4>
<p>To calculate conditional-age-at-length data formatted for Stock
Synthesis:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">caal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_raw_caal.html">get_raw_caal</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">bio</span>, </span>
<span>  len_bins <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">40</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  age_bins <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">40</span><span class="op">)</span></span></code></pre></div>
<p>Creates unexpanded conditional-age-at-length data for each sex with
input sample sizes based on the observed number of fish in each length
bin by year. It returns a dataframe with conditional-age-at-length data
by sex (sex = 0, sex = 1, sex = 2). If the <code>dir</code> function
input is specified, it will write the dataframe to a csv file.</p>
</div>
<div class="section level4">
<h4 id="maps">Maps<a class="anchor" aria-label="anchor" href="#maps"></a>
</h4>
<p>To make a map showing the distribution of density in aggregate and by
year:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/PlotMap.fn.html">PlotMap.fn</a></span><span class="op">(</span></span>
<span>  dat <span class="op">=</span> <span class="va">catch</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="additional-data-visualization">Additional data visualization<a class="anchor" aria-label="anchor" href="#additional-data-visualization"></a>
</h4>
<p>There are a couple of additional plotting functions that are included
in the package:<code><a href="../reference/PlotVarLengthAtAge.fn.html">PlotVarLengthAtAge.fn()</a></code> and
<code><a href="../reference/PlotSexRatio.fn.html">PlotSexRatio.fn()</a></code>.</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Chantel R. Wetzel, Kelli F. Johnson, Allan C. Hicks.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
